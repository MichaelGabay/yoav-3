# תרגילים - שיעור 4 (10.02)
## פונקציות נומריות ואגריגציות בפוסטגר

מסד הנתונים: **Northwind**

---

## תרגיל 1
חשב את הממוצע של מחירי המוצרים (`unit_price`) מהטבלה `products`. הצג את התוצאה עם כינוי `avg_price`.

---

## תרגיל 2
מהטבלה `order_details`, חשב את סכום הכמות (`quantity`) הכוללת שנמכרה. הצג את התוצאה עם כינוי `total_quantity`.

---

## תרגיל 3
מהטבלה `products`, מצא את המחיר הנמוך ביותר (`unit_price`) ואת המחיר הגבוה ביותר. הצג את שתי התוצאות עם כינויים `min_price` ו-`max_price`.

---

## תרגיל 4
ספור כמה לקוחות יש בכל מדינה מהטבלה `customers`. הצג את `country` ואת מספר הלקוחות עם כינוי `customer_count`, ממוין לפי מספר הלקוחות יורד.

---

## תרגיל 5
מהטבלה `order_details`, חשב לכל הזמנה (`order_id`) את סכום הכמות (`quantity`) הכוללת. הצג את `order_id` ואת הסכום עם כינוי `total_quantity`, ממוין לפי הסכום יורד. הצג רק את 10 ההזמנות הראשונות.

---

## תרגיל 6
מהטבלה `products`, חשב את ממוצע המחיר (`unit_price`) לכל קטגוריה (`category_id`). הצג את `category_id` ואת הממוצע עם כינוי `avg_price`, ממוין לפי הממוצע עולה.

---

## תרגיל 7
מהטבלה `order_details`, חשב לכל מוצר (`product_id`) את סכום הכמות (`quantity`) שנמכרה. הצג רק מוצרים שסכום הכמות שלהם גדול מ-500. הצג את `product_id` ואת הסכום עם כינוי `total_sold`, ממוין לפי הסכום יורד.

---

## תרגיל 8
מהטבלה `products`, חשב את ממוצע המחיר (`unit_price`) לכל קטגוריה (`category_id`), אבל רק למוצרים פעילים (`discontinued = 0`). הצג רק קטגוריות שהממוצע שלהן גדול מ-20. הצג את `category_id` ואת הממוצע עם כינוי `avg_price`, ממוין לפי הממוצע יורד.

---

## תרגיל 9
מהטבלה `order_details`, חשב לכל הזמנה (`order_id`) את סכום הערך הכולל: `quantity * unit_price * (1 - discount)`. הצג את `order_id` ואת הסכום עם כינוי `total_value`, ממוין לפי הסכום יורד. הצג רק את 5 ההזמנות הראשונות.

---

## תרגיל 10
מהטבלה `customers`, ספור כמה לקוחות יש בכל מדינה (`country`). הצג רק מדינות שיש בהן יותר מ-5 לקוחות. הצג את `country` ואת מספר הלקוחות עם כינוי `customer_count`, ממוין לפי מספר הלקוחות יורד.

---

## פתרונות

<details>
<summary>לחץ כדי לראות פתרונות</summary>

### פתרון תרגיל 1:
```sql
SELECT AVG(unit_price) AS avg_price
FROM products;
```

### פתרון תרגיל 2:
```sql
SELECT SUM(quantity) AS total_quantity
FROM order_details;
```

### פתרון תרגיל 3:
```sql
SELECT MIN(unit_price) AS min_price, MAX(unit_price) AS max_price
FROM products;
```

### פתרון תרגיל 4:
```sql
SELECT country, COUNT(*) AS customer_count
FROM customers
GROUP BY country
ORDER BY customer_count DESC;
```

### פתרון תרגיל 5:
```sql
SELECT order_id, SUM(quantity) AS total_quantity
FROM order_details
GROUP BY order_id
ORDER BY total_quantity DESC
LIMIT 10;
```

### פתרון תרגיל 6:
```sql
SELECT category_id, AVG(unit_price) AS avg_price
FROM products
GROUP BY category_id
ORDER BY avg_price;
```

### פתרון תרגיל 7:
```sql
SELECT product_id, SUM(quantity) AS total_sold
FROM order_details
GROUP BY product_id
HAVING SUM(quantity) > 500
ORDER BY total_sold DESC;
```

### פתרון תרגיל 8:
```sql
SELECT category_id, AVG(unit_price) AS avg_price
FROM products
WHERE discontinued = 0
GROUP BY category_id
HAVING AVG(unit_price) > 20
ORDER BY avg_price DESC;
```

### פתרון תרגיל 9:
```sql
SELECT order_id, SUM(quantity * unit_price * (1 - discount)) AS total_value
FROM order_details
GROUP BY order_id
ORDER BY total_value DESC
LIMIT 5;
```

### פתרון תרגיל 10:
```sql
SELECT country, COUNT(*) AS customer_count
FROM customers
GROUP BY country
HAVING COUNT(*) > 5
ORDER BY customer_count DESC;
```

</details>
